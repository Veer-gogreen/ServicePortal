<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Service Portal</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    .hidden { display: none; }
    .section { margin-top: 30px; }
  </style>
</head>
<body>
<div class="container mt-4">
  <h2 class="text-center mb-4">Service & Maintenance Portal</h2>

  <!-- Customer Registration -->
  <h4>Customer Registration</h4>
  <form id="customerForm" class="mb-4">
    <input type="text" class="form-control mb-2" id="custName" placeholder="Name" required>
    <input type="tel" class="form-control mb-2" id="custMobile" placeholder="Mobile" required>
    <input type="text" class="form-control mb-2" id="custAddress" placeholder="Address" required>
    <input type="password" class="form-control mb-2" id="custPassword" placeholder="Password" required>
    <button class="btn btn-primary">Register Customer</button>
  </form>

  <!-- Technician Registration -->
  <h4>Technician Registration</h4>
  <form id="technicianForm" class="mb-4">
    <input type="text" class="form-control mb-2" id="techName" placeholder="Name" required>
    <input type="text" class="form-control mb-2" id="techQual" placeholder="Qualification" required>
    <input type="tel" class="form-control mb-2" id="techContact" placeholder="Mobile" required>
    <input type="text" class="form-control mb-2" id="techAddress" placeholder="Address" required>
    <input type="password" class="form-control mb-2" id="techPassword" placeholder="Password" required>
    <button class="btn btn-primary">Register Technician</button>
  </form>

  <!-- Login Section -->
  <h4>Login</h4>
  <form id="loginForm" class="mb-4">
    <select class="form-select mb-2" id="loginType">
      <option value="customer">Customer</option>
      <option value="technician">Technician</option>
    </select>
    <input type="tel" class="form-control mb-2" id="loginMobile" placeholder="Mobile" required>
    <input type="password" class="form-control mb-2" id="loginPassword" placeholder="Password" required>
    <button class="btn btn-success">Login</button>
  </form>

  <!-- Work Allotment (Admin) -->
  <h4>Admin Work Allotment</h4>
  <form id="assignForm" class="mb-4">
    <input type="tel" class="form-control mb-2" id="assignMobile" placeholder="Technician Mobile" required>
    <input type="text" class="form-control mb-2" id="assignWork" placeholder="Work Detail" required>
    <button class="btn btn-warning">Assign Work</button>
  </form>

  <div id="outputMsg" class="text-success mt-3"></div>
</div>

<script>
const scriptURL = "https://script.google.com/macros/s/AKfycbyFX4qTatu1Lynpq-v4dWZsekRvNFJYyce_Zdy6ajJT0_LvATzwIehl8Ybmcmz6RuXbDA/exec";

// Customer Registration
document.getElementById("customerForm").onsubmit = async (e) => {
  e.preventDefault();
  const data = {
    action: "registerCustomer",
    name: custName.value,
    mobile: custMobile.value,
    address: custAddress.value,
    password: custPassword.value
  };
  const res = await fetch(scriptURL, { method: 'POST', body: new URLSearchParams(data) });
  document.getElementById("outputMsg").innerText = await res.text();
  e.target.reset();
};

// Technician Registration
document.getElementById("technicianForm").onsubmit = async (e) => {
  e.preventDefault();
  const data = {
    action: "registerTechnician",
    name: techName.value,
    qualification: techQual.value,
    contact: techContact.value,
    address: techAddress.value,
    password: techPassword.value
  };
  const res = await fetch(scriptURL, { method: 'POST', body: new URLSearchParams(data) });
  document.getElementById("outputMsg").innerText = await res.text();
  e.target.reset();
};

// Login
document.getElementById("loginForm").onsubmit = async (e) => {
  e.preventDefault();
  const loginType = loginType.value;
  const data = {
    action: loginType === "customer" ? "loginCustomer" : "loginTechnician",
    mobile: loginMobile.value,
    password: loginPassword.value
  };
  const res = await fetch(scriptURL, { method: 'POST', body: new URLSearchParams(data) });
  const text = await res.text();
  document.getElementById("outputMsg").innerText = text === "success" ? "Login Successful!" : "Login Failed or Awaiting Approval";
};

// Admin Work Allotment
document.getElementById("assignForm").onsubmit = async (e) => {
  e.preventDefault();
  const data = {
    action: "assignWork",
    technicianMobile: assignMobile.value,
    workDetail: assignWork.value
  };
  const res = await fetch(scriptURL, { method: 'POST', body: new URLSearchParams(data) });
  document.getElementById("outputMsg").innerText = await res.text();
  e.target.reset();
};
</script>
</body>
</html>
