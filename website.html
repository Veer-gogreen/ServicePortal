<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <style>
      body { font-family: Arial; margin: 30px; }
      input, select, button { display: block; margin: 10px 0; width: 300px; padding: 8px; }
      .section { margin-bottom: 30px; }
      h2 { color: green; }
    </style>
  </head>
  <body>
    <h1>Service & Maintenance Portal</h1>

    <div class="section">
      <h2>Customer Registration</h2>
      <input id="custName" placeholder="Name" required>
      <input id="custAddress" placeholder="Address" required>
      <input id="custMobile" placeholder="Mobile Number" required>
      <input id="custPassword" placeholder="Password" type="password" required>
      <button onclick="registerCustomer()">Register</button>
    </div>

    <div class="section">
      <h2>Technician Registration</h2>
      <input id="techName" placeholder="Name" required>
      <input id="techQual" placeholder="Qualification" required>
      <input id="techExp" placeholder="Experience" required>
      <input id="techSpec" placeholder="Specialisation" required>
      <input id="techMobile" placeholder="Mobile Number" required>
      <input id="techAddr" placeholder="Address" required>
      <input id="techPassword" placeholder="Password" type="password" required>
      <button onclick="registerTechnician()">Register</button>
    </div>

    <div class="section">
      <h2>Login</h2>
      <select id="loginRole">
        <option>Customer</option>
        <option>Technician</option>
      </select>
      <input id="loginMobile" placeholder="Mobile Number">
      <input id="loginPassword" placeholder="Password" type="password">
      <button onclick="loginUser()">Login</button>
      <div id="loginResult"></div>
    </div>

    <div class="section">
      <h2>Admin Approval Panel</h2>
      <button onclick="loadApprovals()">Load Pending Approvals</button>
      <div id="approvalList"></div>
    </div>

    <div class="section">
      <h2>Assign Work (Admin)</h2>
      <input id="taskCustomer" placeholder="Customer Name">
      <input id="taskTechnician" placeholder="Technician Name">
      <input id="taskDetail" placeholder="Task Detail">
      <button onclick="assignWork()">Assign Task</button>
    </div>

    <script>
      function registerCustomer() {
        const data = {
          name: custName.value,
          address: custAddress.value,
          mobile: custMobile.value,
          password: custPassword.value
        };
        google.script.run.registerCustomer(data);
        alert("Customer registered. Awaiting approval.");
      }

      function registerTechnician() {
        const data = {
          name: techName.value,
          qualification: techQual.value,
          experience: techExp.value,
          specialisation: techSpec.value,
          mobile: techMobile.value,
          address: techAddr.value,
          password: techPassword.value
        };
        google.script.run.registerTechnician(data);
        alert("Technician registered. Awaiting approval.");
      }

      function loginUser() {
        const role = loginRole.value;
        const mobile = loginMobile.value;
        const password = loginPassword.value;
        google.script.run.withSuccessHandler(function(res) {
          loginResult.innerText = res.success ? `Welcome ${res.name}` : "Invalid login or not approved yet.";
        }).loginUser(role, mobile, password);
      }

      function loadApprovals() {
        google.script.run.withSuccessHandler(function(data) {
          let html = "<h3>Pending Customers</h3>";
          data.customers.forEach((c, i) => {
            html += `${c[0]} - ${c[2]} <button onclick="approve('Customers', ${i})">Approve</button><br>`;
          });
          html += "<h3>Pending Technicians</h3>";
          data.technicians.forEach((t, i) => {
            html += `${t[0]} - ${t[4]} <button onclick="approve('Technicians', ${i})">Approve</button><br>`;
          });
          approvalList.innerHTML = html;
        }).getPendingRegistrations();
      }

      function approve(type, index) {
        google.script.run.approveRegistration(type, index);
        alert(`${type.slice(0, -1)} approved.`);
        loadApprovals();
      }

      function assignWork() {
        const data = {
          customer: taskCustomer.value,
          technician: taskTechnician.value,
          task: taskDetail.value
        };
        google.script.run.assignTask(data);
        alert("Task Assigned.");
      }
    </script>
  </body>
</html>
